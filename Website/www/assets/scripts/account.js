(()=>{"use strict";function e(e,t,a){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class t{constructor(t){e(this,"element",null),e(this,"pageMap",{}),e(this,"currentPageName",null),e(this,"currentPageTitle",null),this.element=t;const a=t.querySelectorAll("div.page-panel-page");for(const e of a){const t=e.getAttribute("page");this.pageMap[t]=e,e.classList.contains("page-panel-visible")&&(this.currentPageName=t)}const n=t.querySelectorAll("div.page-panel-nav a");for(const e of n){const t=e.getAttribute("page");this.pageMap[t]&&(this.pageMap[t].link=e,e.addEventListener("click",(e=>{e.preventDefault(),this.switchPage(e.target.getAttribute("page"))})))}const o=new Event("panelCreated");o.panel=this,this.element.dispatchEvent(o)}switchPage(e){const t=this.currentPageName;if(t===e)return;if(!this.pageMap[e])return;this.pageMap[t].classList.remove("page-panel-visible"),this.pageMap[t].link.parentElement.classList.remove("page-panel-active"),this.pageMap[e].classList.add("page-panel-visible"),this.pageMap[e].link.parentElement.classList.add("page-panel-active"),this.currentPageName=e,this.currentPageTitle=this.pageMap[e].link.innerText;const a=new Event("panelSwitched");a.panel=this,this.element.dispatchEvent(a)}hasPage(e){return Object.hasOwn?Object.hasOwn(this.pageMap,e):Object.prototype.hasOwnProperty.call(this.pageMap,e)}static init(){const e=document.querySelectorAll("div.page-panel");for(const a of e)t.pagePanels[a.id]=new t(a)}}var a;function n(e,t,a){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}e(t,"pagePanels",{});const o="anyAuthenticator";class s{static show(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok";return this.confirm(e,t,a,null)}static confirm(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Cancel",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return new Promise(((s,c)=>{const i=document.getElementById("overlay"),r=document.getElementById("dialog"),l=document.getElementById("dialog_message"),d=document.getElementById("dialog_explanation"),u=document.getElementById("dialog_slot"),p=document.getElementById("dialog_action_button"),h=document.getElementById("dialog_cancel_button");i&&r&&l&&d&&p&&h?(i.className="exist",r.className="exist",setTimeout((()=>{i.className="exist visible",r.className="exist visible"}),10),l.innerText=e,t?(d.innerText=t,d.classList.remove("hidden")):(d.innerText="",d.classList.add("hidden")),u&&(o?(u.innerHTML=o,u.classList.remove("hidden")):(u.innerText="",u.classList.add("hidden"))),p.clickHandler&&p.removeEventListener("click",p.clickHandler),h.clickHandler&&h.removeEventListener("click",h.clickHandler),p.clickHandler=()=>{this.hide(),setTimeout((()=>{s()}),300)},p.addEventListener("click",p.clickHandler),p.innerText=a,n?(h.clickHandler=()=>{this.hide(),setTimeout((()=>{c()}),300)},h.addEventListener("click",h.clickHandler),h.innerText=n):h.className="hidden"):c()}))}static hide(){var e=document.getElementById("overlay"),t=document.getElementById("dialog");e&&t&&(e.className="exist",t.className="exist",setTimeout((()=>{e.className="",t.className=""}),300))}static showModal(e){if(this.activeModal)return;const t=document.getElementById("overlay"),a=document.getElementById(e);t&&a&&(t.classList.add("exist"),a.classList.add("exist"),this.activeModal=e,setTimeout((()=>{t.classList.add("visible"),a.classList.add("visible")}),10),this.viewportWatcher=setInterval((()=>{if(!this.activeModal)return;document.querySelectorAll("#".concat(this.activeModal," .modal-content .content")).forEach((e=>{a.classList.toggle("scrolled",e.scrollHeight>e.clientHeight)}));const e=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);a.classList.toggle("centered",a.clientHeight>.75*e)}),100))}static hideModal(){return new Promise(((e,t)=>{if(!this.activeModal)return void t();const a=document.getElementById("overlay"),n=document.getElementById(this.activeModal);a&&n?(this.viewportWatcher&&(clearInterval(this.viewportWatcher),this.viewportWatcher=null),a.classList.remove("visible"),n.classList.remove("visible"),setTimeout((()=>{a.classList.remove("exist"),n.classList.remove("exist"),this.activeModal=null,e()}),300)):t()}))}}a=s,n(s,"activeModal",null),n(s,"viewportWatcher",null),n(s,"secureConfirm",(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Ok",c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Cancel";return new Promise(((i,r)=>{let l;switch(e){case"password":l=a.confirm(t,n,s,c,'<div class="floating-label"><input type="password" class="text-field" id="dialog_confirm_field" placeholder="Account Password"><label for="dialog_confirm_field">Account Password</label></div>');break;case o:l=a.confirm(t,n,s,c,'<div class="floating-label"><input type="text" class="text-field" id="dialog_confirm_field" placeholder="Two Step Code"><label for="dialog_confirm_field">Two Step Code</label></div>');break;default:console.log("Unknown security option ".concat(e)),r("Unknown security option")}l.then((()=>{const e=document.getElementById("dialog_confirm_field");i(e.value)})).catch((()=>{r()}))}))}));class c{static prepareResponse(e){return{xhr:e,status:e.status,statusText:e.statusText,body:e.responseText,success:e.status>=200&&e.status<300||304===e.status}}static start(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise(((o,s)=>{const c=new XMLHttpRequest;if(c.open(e,t,!0),"object"==typeof n&&null!==n&&!1===Array.isArray(n)){const e=Object.keys(n);for(const t of e)c.setRequestHeader(t,n[t])}c.onload=()=>{const e=this.prepareResponse(c);e.success?o(e):s(e)},c.onerror=()=>{s(this.prepareResponse(c))},c.send(a)}))}static get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c.start("GET",e,null,t)}static post(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t instanceof URLSearchParams?(a["Content-Type"]="application/x-www-form-urlencoded",c.start("POST",e,t.toString(),a)):"object"==typeof t&&null!==t||Array.isArray(t)?(a["Content-Type"]="application/json",c.start("POST",e,JSON.stringify(t),a)):c.start("POST",e,t,a)}static delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c.start("DELETE",e,null,t)}}const i=()=>crypto.randomUUID?crypto.randomUUID():([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)));document.addEventListener("beaconRunAccountPanel",(e=>{let{accountProperties:a}=e,n="";const r=a.sessionId,l=a.apiDomain,d=document.getElementById("account-user-header"),u=d.getAttribute("beacon-user-name"),p=d.getAttribute("beacon-user-suffix"),h="".concat(u,"#").concat(p),m=()=>{let e=window.location.hash;return e?(e.startsWith("#")&&(e=e.substr(1)),e):""};t.init();const g=t.pagePanels["panel-account"];g&&(g.switchPage(m()),window.addEventListener("popstate",(()=>{g.switchPage(m())})));const v=document.getElementById("panel-account");v&&v.addEventListener("panelSwitched",(e=>{window.location.hash=e.panel.currentPageName}));const w=document.querySelectorAll('#panel-account div[page="projects"] [beacon-action="delete"]');for(const e of w)e.addEventListener("click",(e=>{e.preventDefault();const t=e.target.getAttribute("beacon-resource-url"),a=e.target.getAttribute("beacon-resource-name");return s.confirm('Are you sure you want to delete the project "'+a+'?"',"The project will be deleted immediately and cannot be recovered.","Delete").then((()=>{c.delete(t,{"X-Beacon-Token":r}).then((()=>{s.show("Project deleted",'"'+a+'" has been deleted.').then((()=>{window.location.reload(!0)}))})).catch((e=>{401===e.status?s.show("Project not deleted","There was an authentication error"):s.show("Project not deleted","Sorry, there was a ".concat(e.status," error."))}))})).catch((()=>{})),!1}));const b=document.getElementById("username_action_button"),y=document.getElementById("username_field"),f=document.getElementById("suggested-username-link"),E=document.getElementById("new-suggestion-link");b&&y&&(y.addEventListener("input",(e=>{b.disabled=""===e.target.value.trim()})),b.addEventListener("click",(e=>{e.preventDefault();const t=y.value.trim();if(""===t)return s.show("Username can not be empty","How did you press the button anyway?"),!1;const a=new URLSearchParams;a.append("username",t),c.post("/account/actions/username",a).then((e=>{const t={message:"Username changed",explanation:"Your username has been changed."};try{const a=JSON.parse(e.body);t.explanation='Your username has been changed to "'.concat(a.username,'."')}catch(e){}s.show(t.message,t.explanation).then((()=>{window.location.reload(!0)}))})).catch((e=>{switch(e.status){case 401:case 403:s.show("Username not changed","There was an authentication error.");break;default:s.show("Username not changed","Sorry, there was a ".concat(e.status," error."))}}))})),f&&(f.addEventListener("click",(e=>(e.preventDefault(),y.value=e.currentTarget.getAttribute("beacon-username"),b.disabled=""===y.value.trim(),!1))),E&&E.addEventListener("click",(e=>(c.get("/account/login/suggest").then((e=>{try{const t=JSON.parse(e.body);f&&(f.innerText=t.username,f.setAttribute("beacon-username",t.username))}catch(e){}})).catch((()=>{})),e.preventDefault(),!1)))));const k=document.getElementById("email_field"),L=document.getElementById("email_action_button"),T=document.getElementById("email_need_2fa"),I=document.getElementById("email_2fa_action_button"),B=document.getElementById("email_2fa_cancel_button"),x=document.getElementById("email_2fa_code_field");if(k&&L&&T){k.addEventListener("input",(e=>{L.disabled=""===e.target.value.trim()}));const e=()=>{const e=new URLSearchParams;e.append("email",k.value.trim()),e.append("verify",x?x.value.trim():""),c.post("/account/actions/email",e).then((()=>{s.show("Email Change Started","The new address has been emailed a link. Please click the link to complete the change.").then((()=>{window.location.reload(!0)}))})).catch((e=>{try{const t=JSON.parse(e.body);if(!t.message)throw new Error;const a=t.message;s.show("Email Change Error",a)}catch(t){switch(e.status){case 401:case 403:s.show("Email Change Error","There was an authentication error.");break;default:s.show("Email Change Error","Sorry, there was a ".concat(e.status," error."))}}}))};L.addEventListener("click",(t=>{t.preventDefault(),"true"===T.value?(x.value="",s.showModal("change_email_2fa_form"),x.focus()):e()})),I&&I.addEventListener("click",(t=>{t.preventDefault(),s.hideModal().then((()=>{e()}))})),B&&B.addEventListener("click",(e=>{e.preventDefault(),s.hideModal()})),x&&x.addEventListener("input",(e=>{I.disabled=""===e.target.value.trim()}))}const S=document.getElementById("password_action_button"),A=document.getElementById("password_regenerate_check"),_=document.getElementById("change_password_form"),P=document.getElementById("password_current_field"),O=document.getElementById("password_initial_field"),M=document.getElementById("password_confirm_field"),U=document.getElementById("password_auth_field"),N=document.getElementById("add-authenticator-button"),C=document.getElementById("add-authenticator-code-field"),D=document.getElementById("add-authenticator-password-field"),R=document.getElementById("add-authenticator-nickname-field"),j=document.getElementById("add-authenticator-action-button"),H=document.getElementById("add-authenticator-cancel-button"),J=document.getElementById("add-authenticator-qrcode"),q=document.getElementById("add-authenticator-error-message"),Y=document.getElementById("authenticators_time_zone_name"),X=document.getElementById("replace-backup-codes-button");S&&A&&_&&S.addEventListener("click",(e=>{e.preventDefault();const t=P?P.value:"",a=O?O.value:"",o=M?M.value:"",i=a===n,r=A.checked,l=r;if(a.length<8)return s.show("Password too short","Your password must be at least 8 characters long."),!1;if(a!==o)return s.show("Passwords do not match","Please make sure the two passwords match."),!1;const d=new URLSearchParams;return d.append("current_password",t),d.append("password",a),d.append("allow_vulnerable",i),l&&d.append("terminate_sessions",!0),r&&d.append("regenerate_key",!0),U&&d.append("auth_code",U.value),c.post("/account/actions/password",d).then((()=>{_.reset();try{const e={};e.message=r?"Your password and private key have been changed.":"Your password has been changed.",e.explanation="All sessions have been revoked and your devices will need to sign in again.",s.show(e.message,e.explanation)}catch(e){console.log(e),s.show("There was an error. Your password may or may not have been changed.")}})).catch((e=>{let t="Unable to change password",o="There was a ".concat(e.status," error while trying to change your password.");try{const t=JSON.parse(e.body);t.message&&(o=t.message)}catch(e){}switch(e.status){case 403:t="Incorrect Two Step Verification Code",o="Please get a new code from your authenticator app.";break;case 438:n=a,t="Your password is vulnerable.",o="Your password has been leaked in a previous breach and should not be used. To ignore this warning, you may submit the password again, but that is not recommended."}s.show(t,o)})),!1}));const W=()=>{if(S)return P&&O&&M?void(S.disabled=""===P.value.trim()||""===O.value.trim()||O.value!==M.value):(console.log("Missing page fields"),void(S.disabled=!0))};if(P&&P.addEventListener("input",W),O&&O.addEventListener("input",W),M&&M.addEventListener("input",W),N&&D&&C&&R&&j&&H)try{const e=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",t=new Uint32Array(4);self.crypto.getRandomValues(t);let a="";for(const n of t)a+=e[n>>>27&31]+e[n>>>22&31]+e[n>>>17&31]+e[n>>>12&31]+e[n>>>7&31]+e[n>>>2&31];return a},t={authenticatorId:i(),type:"TOTP",nickname:"Google Authenticator",metadata:{secret:null,setup:null}},a=()=>{j.disabled=""===C.value.trim()||""===D.value||""===R.value};C.addEventListener("input",a),D.addEventListener("input",a),R.addEventListener("input",a),N.addEventListener("click",(()=>{t.metadata.secret=e(),t.metadata.setup="otpauth://totp/".concat(encodeURIComponent("Beacon:"+h+" ("+t.authenticatorId+")"),"?secret=").concat(t.metadata.secret,"&issuer=Beacon"),J&&(J.src="/account/assets/qr.php?content=".concat(btoa(t.metadata.setup)),J.setAttribute("alt",t.metadata.setup),J.setAttribute("title",t.metadata.setup)),C.value="",s.showModal("add-authenticator-modal")})),H.addEventListener("click",(()=>{s.hideModal()})),j.addEventListener("click",(()=>{q.innerText="",q.classList.add("hidden"),t.nickname=R.value.trim(),t.verificationCode=C.value.trim(),t.password=D.value,c.post("https://".concat(l,"/v4/authenticators"),t,{"X-Beacon-Token":r}).then((()=>{window.location.reload(!0)})).catch((e=>{q.innerText=(()=>{try{return JSON.parse(e.body).message}catch(e){return"Incorrect verification code"}})(),q.classList.remove("hidden")}))}))}catch(e){N.addEventListener("click",(()=>{s.show("Sorry, this browser is not supported","There was an error generating the authenticator, which means your browser does not support modern cryptography features. Try again with an updated browser.")}))}let F=document.querySelectorAll("#authenticators-table tbody tr").length;if(F>0){(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];document.querySelectorAll("time").forEach((a=>{const n=new Date(a.getAttribute("datetime"));a.innerText=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=Intl.DateTimeFormat().resolvedOptions(),o={dateStyle:"medium"};t&&(o.timeStyle="short");let s=Intl.DateTimeFormat(n.locale,o).format(e);return a&&(s="".concat(s," ").concat(n.timeZone)),s}(n,e,t)}))})(!0,!1),Y&&(Y.innerText=Intl.DateTimeFormat().resolvedOptions().timeZone);const e=document.querySelectorAll("button.delete_authenticator_button");for(const t of e)t.addEventListener("click",(e=>{const t=e.target.getAttribute("beacon-authenticator-id"),a=e.target.getAttribute("beacon-authenticator-name"),n={message:"Are you sure you want to delete the authenticator ".concat(a,"?")};if(F>1){const e=F-1,t=1===e?"authenticator":"authenticators";n.explanation="You will have ".concat(e," ").concat(t," remaining. Your account will still be protected by two factor authentication.")}else n.explanation="This is your only authenticator. Deleting it will disable two factor authentication for your account. You will be able to add a new authenticator to enable two factor authentication again.";n.explanation+=" To delete this authenticator, please use it to generate a code",s.secureConfirm(o,n.message,n.explanation).then((e=>{c.start("DELETE","https://".concat(l,"/v4/authenticators"),JSON.stringify({authenticatorId:t,authCode:e}),{"X-Beacon-Token":r,"Content-Type":"application/json"}).then((()=>{const e=document.getElementById("authenticator-".concat(t));e&&F>1?(e.remove(),F--):window.location.reload(!0)})).catch((e=>{const t={message:"The authenticator was not deleted",explanation:"There was a ".concat(e.status," error.")};try{const a=JSON.parse(e.body);a.message&&(t.explanation=a.message)}catch(e){}s.show(t.message,t.explanation)}))})).catch((()=>{}))}))}X&&X.addEventListener("click",(()=>{s.confirm("Replace backup codes?","This will replace all of your backup codes with new ones.").then((()=>{c.post("/account/actions/replace_backup_codes",{},{"X-Beacon-Token":r}).then((e=>{try{const t=document.getElementById("backup-codes"),a=JSON.parse(e.body).codes;t.innerHTML="";for(const e of a){const a=document.createElement("div");a.innerText=e,a.className="flex-grid-item",t.appendChild(a)}}catch(e){window.location.reload(!0)}})).catch((e=>{console.log(JSON.stringify(e));const t={message:"Backup codes not replaced",explanation:"There was a ".concat(e.status," error.")};try{const a=JSON.parse(e.body);a.message&&(t.explanation=a.message)}catch(e){}s.show(t.message,t.explanation)}))})).catch((()=>{}))}));const G=e=>(e.preventDefault(),c.delete("https://".concat(l,"/v4/sessions/").concat(encodeURIComponent(e.target.getAttribute("sessionHash"))),{"X-Beacon-Token":r}).then((()=>{s.show("Session revoked","Be aware that any enabled user with a copy of your account's private key can start a new session.").then((()=>{window.location.reload(!0)}))})).catch((e=>{401===e.status?s.show("Session not revoked","There was an authentication error"):s.show("Session not revoked","Sorry, there was a "+e.status+" error.")})),!1),V=document.querySelectorAll('#panel-account div[page="sessions"] a.revokeLink');for(const e of V)e.addEventListener("click",G);const Z=document.getElementById("apps-create-button"),z=document.getElementById("app-editor-cancel-button"),K=document.getElementById("app-editor-action-button"),Q=document.getElementById("app-editor-icon-choose-button"),$=document.getElementById("app-editor-icon-chooser"),ee=document.getElementById("app-editor-icon-cell"),te=document.getElementById("app-editor-icon-disclaimer"),ae=document.getElementById("app-editor-name-field"),ne=document.getElementById("app-editor-website-field"),oe=document.getElementById("app-editor-security-group"),se=document.getElementById("app-editor-confidential-check"),ce=Array.from(document.querySelectorAll(".app-scope-checkbox")),ie=document.getElementById("app-editor-secret-hint"),re=document.getElementById("app-editor-callbacks-field");if(Z&&z&&K&&Q&&$&&ee&&ae&&ne&&oe&&se){let e,t,a;const n=n=>{var o,c,r,l,d;a=!Object.hasOwn(n,"applicationId"),e=null!==(o=n.applicationId)&&void 0!==o?o:i(),ae.value=null!==(c=n.name)&&void 0!==c?c:"",ne.value=null!==(r=n.website)&&void 0!==r?r:"",n.applicationId?oe.classList.add("hidden"):oe.classList.remove("hidden"),se.checked=!1;for(const e of ce){var u;e.checked=null===(u=n.scopes)||void 0===u?void 0:u.includes(e.value)}n.iconUrls?(ee.setAttribute("src",n.iconUrls[64]),ee.setAttribute("srcset","".concat(n.iconUrls[64],", ").concat(n.iconUrls[128]," 2x, ").concat(n.iconUrls[256]," 3x"))):(ee.setAttribute("src","https://assets.usebeacon.app/images/avatars/default/64px.png"),ee.setAttribute("srcset","https://assets.usebeacon.app/images/avatars/default/64px.png, https://assets.usebeacon.app/images/avatars/default/128px.png 2x, https://assets.usebeacon.app/images/avatars/default/256px.png 3x")),$.value=null,t=n.scopes?n.scopes.filter((e=>!ce.some((t=>t.value===e)))):[],re.value=null!==(l=null===(d=n.callbacks)||void 0===d?void 0:d.join("\n"))&&void 0!==l?l:"",te&&te.classList.add("hidden"),K.innerText=a?"Add":"Update",s.showModal("app-editor-modal")},d=e=>{e.preventDefault();const t=e.currentTarget.getAttribute("beacon-app-id");c.get("https://".concat(l,"/v4/applications/").concat(encodeURIComponent(t)),{"X-Beacon-Token":r}).then((e=>{const t=JSON.parse(e.body);n(t)})).catch((()=>{s.show("Could not retrieve application info")}))},u=e=>{e.preventDefault();const t=e.currentTarget.getAttribute("beacon-app-id");s.secureConfirm(o,"Are you sure you want to delete this application?","All user logins created by this application will be invalidated. To delete this application, please enter a code from your authenticator app.").then((e=>{c.start("DELETE","https://".concat(l,"/v4/applications"),JSON.stringify({applicationId:t,authCode:e}),{"X-Beacon-Token":r,"Content-Type":"application/json"}).then((()=>{s.show("The application has been deleted").then((()=>{location.reload()}))})).catch((e=>{const t=JSON.parse(e.body);let a=t.message;"invalidAuthCode"===t.code&&(a="The authenticator code is not correct. Please provide a code from any of your authenticator apps, not a backup code."),s.show("The application could not be deleted",a)}))})).catch((()=>{console.log("App delete was cancelled")}))};document.querySelectorAll('#panel-account div[page="apps"] button.apps-edit-button').forEach((e=>{e.addEventListener("click",d)})),document.querySelectorAll('#panel-account div[page="apps"] button.apps-delete-button').forEach((e=>{e.addEventListener("click",u)})),Z.addEventListener("click",(e=>{e.preventDefault(),n({})})),K.addEventListener("click",(n=>{n.preventDefault(),n.target.disabled=!0,z.disabled=!0;const o={applicationId:e,name:ae.value,website:ne.value,scopes:[...t,...ce.filter((e=>e.checked)).map((e=>e.value))].sort(),callbacks:re.value.replace(/(\r\n)|\r|\n/g,"\n").split("\n").filter((e=>""!==e))};a&&!0===se.checked&&(o.secret="plink");const i=()=>{const e={"X-Beacon-Token":r,"Content-Type":"application/json"},t=e=>{const t=JSON.parse(e.body);t.secret?s.hideModal().then((()=>{s.show("Your application has been registered.","Your secret is below. You will not be shown this secret again.\n\n".concat(t.secret)).then((()=>{location.reload()}))})):location.reload()},n=e=>{const t=JSON.parse(e.body);s.hideModal().then((()=>{s.show("Your application could not be saved",t.message).then((()=>{K.disabled=!1,z.disabled=!1,s.showModal("app-editor-modal")}))}))};a?c.post("https://".concat(l,"/v4/applications"),JSON.stringify(o),e).then(t).catch(n):c.start("PATCH","https://".concat(l,"/v4/applications/").concat(o.applicationId),JSON.stringify(o),e).then(t).catch(n)};var d;$&&1===$.files.length?(d=$.files[0],new Promise(((e,t)=>{const a=new FileReader;a.onload=()=>{e(a.result)},a.onerror=t,a.readAsBinaryString(d)}))).then((e=>{o.iconData=btoa(e),i()})).catch((e=>{s.show("Unable to read icon data",e.message)})):i()})),z.addEventListener("click",(e=>{e.preventDefault(),s.hideModal()})),ie&&se.addEventListener("change",(()=>{se.checked?ie.classList.remove("hidden"):ie.classList.add("hidden")})),Q.addEventListener("click",(e=>{e.preventDefault(),$.click()})),$.addEventListener("change",(()=>{if(1!==$.files.length)return ee.setAttribute("src","https://assets.usebeacon.app/images/avatars/default/64px.png"),ee.setAttribute("srcset","https://assets.usebeacon.app/images/avatars/default/64px.png, https://assets.usebeacon.app/images/avatars/default/128px.png 2x, https://assets.usebeacon.app/images/avatars/default/256px.png 3x"),void(te&&te.classList.add("hidden"));ee.setAttribute("src",URL.createObjectURL($.files[0])),ee.removeAttribute("srcset"),te&&te.classList.remove("hidden")}))}const le=document.getElementById("static-token-modal"),de=document.getElementById("static-token-name-field"),ue=document.getElementById("static-token-token-field"),pe=document.getElementById("static-token-cancel-button"),he=document.getElementById("static-token-action-button"),me=document.getElementById("static-token-provider-field"),ge=document.getElementById("static-token-generate-link"),ve=document.getElementById("static-token-help-field"),we=document.getElementById("static-token-error-field"),be=e=>{e.preventDefault();const t=e.currentTarget.getAttribute("beacon-provider"),a=e.currentTarget.getAttribute("beacon-provider-type"),n=e.currentTarget.getAttribute("beacon-token-id"),o=e.currentTarget.getAttribute("beacon-token-name");if(""===n)switch(a){case"oauth":window.location="/account/oauth/v4/begin/".concat(t);break;case"static":if(le&&de&&ue&&me&&ge&&ve){switch(de.value="",ue.value="",me.value=t,we.classList.add("hidden"),t){case"nitrado":ge.href="https://server.nitrado.net/usa/developer/tokens",ve.innerText='Beacon requires long life tokens from Nitrado to have the "service" scope enabled.',ve.classList.remove("hidden");break;case"gameserverapp.com":ge.href="https://dash.gameserverapp.com/configure/api",ve.innerText='On your GameServerApp.com dashboard, you will find an "API / Integrate" option where you can issue a token for Beacon. Copy the token into the field below to continue. Remember to keep your token in a safe place in case you need it again.',ve.classList.remove("hidden");break;case"asamanager":ge.href="https://asamanager.app/tokens",ve.innerText='At ASA Manager, press the "Create Token" button. When asked for a name, you may choose whatever you like, but "Beacon" is recommended so you don\'t forget what it is for. You will then be shown the token so you can copy it and paste it back here.',ve.classList.remove("hidden")}s.showModal("static-token-modal")}}else s.confirm("Are you sure you want to remove the service ".concat(o,"?"),"You will be able to connect the service again if you choose to.","Delete","Cancel").then((()=>{c.delete("https://".concat(l,"/v4/tokens/").concat(n),{"X-Beacon-Token":r}).then((()=>{window.location.reload(!0)})).catch((()=>{s.show("The service was not deleted.")}))}))},ye=document.querySelectorAll('#panel-account div[page="services"] .service-action button');for(const e of ye)e.addEventListener("click",be);if(le&&de&&ue&&pe&&he&&me&&we){const e=()=>{he.disabled=""===de.value.trim()||""===ue.value.trim()};de.addEventListener("input",(()=>{e()})),ue.addEventListener("input",(()=>{e()})),pe.addEventListener("click",(e=>{e.preventDefault(),s.hideModal()})),he.addEventListener("click",(e=>{e.preventDefault(),he.disabled=!0,we.classList.add("hidden");const t={provider:me.value,type:"Static",accessToken:ue.value.trim(),providerSpecific:{tokenName:de.value.trim()}};c.post("https://".concat(l,"/v4/user/tokens"),t,{"X-Beacon-Token":r}).then((()=>{window.location.reload(!0)})).catch((e=>{try{const t=JSON.parse(e.body);we.innerText=t.message}catch(e){we.innerText="Could not save token."}we.classList.remove("hidden"),he.disabled=!1}))}))}const fe=new URLSearchParams(window.location.search);if(fe.get("message")&&fe.get("explanation")){s.show(fe.get("message"),fe.get("explanation"));const e=new(window.URL||window.webkitURL||window.mozURL||window.msURL||window.oURL)(window.location);e.search="",window.history.replaceState(null,document.title,e.toString())}const Ee=document.getElementById("openBillingPortalButton");Ee&&Ee.addEventListener("click",(e=>{e.preventDefault(),Ee.disabled=!0;const t=new URLSearchParams;t.append("returnUrl",Ee.getAttribute("return-url")),c.get("https://".concat(l,"/v4/user/billingPortal?").concat(t.toString()),{"X-Beacon-Token":r}).then((e=>{Ee.disabled=!1;try{const t=JSON.parse(e.body);window.location.href=t.portalUrl}catch(e){s.show("Could not open your billing portal.","There was an unexpected error.")}})).catch((()=>{Ee.disabled=!1,s.show("Could not open your billing portal.","Sorry about that. This can happen with older logins. Try signing out and signing back in.")}))}))}))})();