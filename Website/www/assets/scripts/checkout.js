(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,i(a.key),a)}}function n(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(t){var n=function(t,n){if("object"!==e(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var a=i.call(t,"string");if("object"!==e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===e(n)?n:String(n)}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,i;return n=e,i=[{key:"show",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok";return this.confirm(e,t,n,null)}},{key:"confirm",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Cancel";return new Promise((function(r,o){var c=document.getElementById("overlay"),l=document.getElementById("dialog"),s=document.getElementById("dialog_message"),u=document.getElementById("dialog_explanation"),d=document.getElementById("dialog_action_button"),h=document.getElementById("dialog_cancel_button");c&&l&&s&&u&&d&&h?(c.className="exist",l.className="exist",setTimeout((function(){c.className="exist visible",l.className="exist visible"}),10),s.innerText=e,u.innerText=n||"",d.clickHandler&&d.removeEventListener("click",d.clickHandler),h.clickHandler&&h.removeEventListener("click",h.clickHandler),d.clickHandler=function(){t.hide(),setTimeout((function(){r()}),300)},d.addEventListener("click",d.clickHandler),d.innerText=i,a?(h.clickHandler=function(){t.hide(),setTimeout((function(){o()}),300)},h.addEventListener("click",h.clickHandler),h.innerText=a):h.className="hidden"):o()}))}},{key:"hide",value:function(){var e=document.getElementById("overlay"),t=document.getElementById("dialog");e&&t&&(e.className="exist",t.className="exist",setTimeout((function(){e.className="",t.className=""}),300))}},{key:"showModal",value:function(e){var t=this;if(!this.activeModal){var n=document.getElementById("overlay"),i=document.getElementById(e);n&&i&&(n.classList.add("exist"),i.classList.add("exist"),this.activeModal=e,setTimeout((function(){n.classList.add("visible"),i.classList.add("visible")}),10),this.viewportWatcher=setInterval((function(){if(t.activeModal){document.querySelectorAll("#".concat(t.activeModal," .modal-content .content")).forEach((function(e){i.classList.toggle("scrolled",e.scrollHeight>e.clientHeight)}));var e=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);i.classList.toggle("centered",i.clientHeight>.75*e)}}),100))}}},{key:"hideModal",value:function(){var e=this;return new Promise((function(t,n){if(e.activeModal){var i=document.getElementById("overlay"),a=document.getElementById(e.activeModal);i&&a?(e.viewportWatcher&&(clearInterval(e.viewportWatcher),e.viewportWatcher=null),i.classList.remove("visible"),a.classList.remove("visible"),setTimeout((function(){i.classList.remove("exist"),a.classList.remove("exist"),e.activeModal=null,t()}),300)):n()}else n()}))}}],null&&t(n.prototype,null),i&&t(n,i),Object.defineProperty(n,"prototype",{writable:!1}),e}();function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===r(a)?a:String(a)),i)}var a}n(a,"activeModal",null),n(a,"viewportWatcher",null);var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"prepareResponse",value:function(e){return{xhr:e,status:e.status,statusText:e.statusText,body:e.responseText,success:e.status>=200&&e.status<300||304===e.status}}},{key:"start",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise((function(o,c){var l=new XMLHttpRequest;if(l.open(e,t,!0),"object"===r(a)&&null!==a&&!1===Array.isArray(a))for(var s=0,u=Object.keys(a);s<u.length;s++){var d=u[s];l.setRequestHeader(d,a[d])}l.onload=function(){var e=n.prepareResponse(l);e.success?o(e):c(e)},l.onerror=function(){c(n.prepareResponse(l))},l.send(i)}))}},{key:"get",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.start("GET",t,null,n)}},{key:"post",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n instanceof URLSearchParams?(i["Content-Type"]="application/x-www-form-urlencoded",e.start("POST",t,n.toString(),i)):"object"===r(n)&&null!==n||Array.isArray(n)?(i["Content-Type"]="application/json",e.start("POST",t,JSON.stringify(n),i)):e.start("POST",t,n,i)}},{key:"delete",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.start("DELETE",t,null,n)}}],null&&o(t.prototype,null),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw r}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,f(i.key),i)}}function h(e,t,n){return(t=f(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){var t=function(e,t){if("object"!==l(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!==l(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===l(t)?t:String(t)}var v=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),h(this,"element",null),h(this,"pageMap",{}),h(this,"currentPageName",null),h(this,"currentPageTitle",null),this.element=t;var i,a=s(t.querySelectorAll("div.page-panel-page"));try{for(a.s();!(i=a.n()).done;){var r=i.value,o=r.getAttribute("page");this.pageMap[o]=r,r.classList.contains("page-panel-visible")&&(this.currentPageName=o)}}catch(e){a.e(e)}finally{a.f()}var c,l=s(t.querySelectorAll("div.page-panel-nav a"));try{for(l.s();!(c=l.n()).done;){var u=c.value,d=u.getAttribute("page");this.pageMap[d]&&(this.pageMap[d].link=u,u.addEventListener("click",(function(e){e.preventDefault(),n.switchPage(e.target.getAttribute("page"))})))}}catch(e){l.e(e)}finally{l.f()}var f=new Event("panelCreated");f.panel=this,this.element.dispatchEvent(f)}var t,n,i;return t=e,i=[{key:"init",value:function(){var t,n=s(document.querySelectorAll("div.page-panel"));try{for(n.s();!(t=n.n()).done;){var i=t.value;e.pagePanels[i.id]=new e(i)}}catch(e){n.e(e)}finally{n.f()}}}],(n=[{key:"switchPage",value:function(e){var t=this.currentPageName;if(t!==e&&this.pageMap[e]){this.pageMap[t].classList.remove("page-panel-visible"),this.pageMap[t].link.parentElement.classList.remove("page-panel-active"),this.pageMap[e].classList.add("page-panel-visible"),this.pageMap[e].link.parentElement.classList.add("page-panel-active"),this.currentPageName=e,this.currentPageTitle=this.pageMap[e].link.innerText;var n=new Event("panelSwitched");n.panel=this,this.element.dispatchEvent(n)}}},{key:"hasPage",value:function(e){return Object.hasOwn?Object.hasOwn(this.pageMap,e):Object.prototype.hasOwnProperty.call(this.pageMap,e)}}])&&d(t.prototype,n),i&&d(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();h(v,"pagePanels",{});var m=function(e){return Intl.NumberFormat("en-US",{style:"currency",currency:e}).format},k=function(e){return new Date(1e3*e)},p=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Intl.DateTimeFormat().resolvedOptions(),a={dateStyle:"medium"};t&&(a.timeStyle="short");var r=Intl.DateTimeFormat(i.locale,a).format(e);return n&&(r="".concat(r," ").concat(i.timeZone)),r};function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t,n){return(t=P(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=S(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw r}}}}function S(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,P(i.key),i)}}function B(e,t,n){return t&&C(e.prototype,t),n&&C(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function P(e){var t=function(e,t){if("object"!==y(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!==y(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===y(t)?t:String(t)}function L(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function T(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,O(e,t,"get"))}function x(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,O(e,t,"set"),n),n}function O(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var F="owns",M="buying",D="in-cart",j="none";document.addEventListener("beaconRunCheckout",(function(e){var t=e.checkoutProperties,n=t.products,i=t.productIds,r=m(t.currencyCode),o=t.games,l=o.filter((function(e){return"Ark"!==e.gameId&&"ArkSA"!==e.gameId}));v.init();var s=v.pagePanels["panel-games"];s&&s.element.addEventListener("panelSwitched",(function(){s.currentPageTitle?document.title="Beacon Omni for ".concat(s.currentPageTitle):document.title="Beacon Omni",history.pushState({},"","/omni#".concat(s.currentPageName))}));var u=new WeakMap,d=new WeakMap,h=new WeakMap,f=function(){function e(t){I(this,e),L(this,u,{writable:!0,value:null}),L(this,d,{writable:!0,value:{}}),L(this,h,{writable:!0,value:!1}),t?(x(this,u,t.id),x(this,d,t.products),x(this,h,t.isGift)):x(this,u,crypto.randomUUID?crypto.randomUUID():([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})))}return B(e,[{key:"id",get:function(){return T(this,u)}},{key:"isGift",get:function(){return T(this,h)},set:function(e){x(this,h,e)}},{key:"productIds",get:function(){return Object.keys(T(this,d))}},{key:"count",get:function(){return Object.keys(T(this,d)).length}},{key:"reset",value:function(){x(this,d,{})}},{key:"add",value:function(e,t){this.setQuantity(e,this.getQuantity(e)+t)}},{key:"remove",value:function(e,t){this.setQuantity(e,this.getQuantity(e)-t)}},{key:"getQuantity",value:function(e){var t;return null!==(t=T(this,d)[e])&&void 0!==t?t:0}},{key:"setQuantity",value:function(e,t){t<=0?Object.prototype.hasOwnProperty.call(T(this,d),e)&&delete T(this,d)[e]:T(this,d)[e]=t}},{key:"toJSON",value:function(){return{id:T(this,u),products:T(this,d),isGift:T(this,h)}}},{key:"fingerprint",get:function(){var e=this,t=Object.keys(T(this,d)).sort().reduce((function(t,n){return t[n]=T(e,d)[n],t}),{});return btoa(JSON.stringify({id:T(this,u),products:t,isGift:T(this,h)}))}},{key:"hasArk",get:function(){var e;return this.getQuantity(null==n||null===(e=n.Ark)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)>0}},{key:"hasArkSA",get:function(){var e,t,i;return this.getQuantity(null==n||null===(e=n.ArkSA)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)>0||this.getQuantity(null==n||null===(t=n.ArkSA)||void 0===t||null===(t=t.Upgrade)||void 0===t?void 0:t.ProductId)>0||this.getQuantity(null==n||null===(i=n.ArkSA)||void 0===i||null===(i=i.Renewal)||void 0===i?void 0:i.ProductId)>0}},{key:"arkSAYears",get:function(){var e,t,i;return Math.min(this.getQuantity(null==n||null===(e=n.ArkSA)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)+this.getQuantity(null==n||null===(t=n.ArkSA)||void 0===t||null===(t=t.Upgrade)||void 0===t?void 0:t.ProductId)+this.getQuantity(null==n||null===(i=n.ArkSA)||void 0===i||null===(i=i.Renewal)||void 0===i?void 0:i.ProductId),5)}},{key:"hasGame",value:function(e){var t,i;return"ArkSA"===e?this.hasArkSA:this.getQuantity(null==n||null===(t=n[e])||void 0===t||null===(t=t.Base)||void 0===t?void 0:t.ProductId)>0||this.getQuantity(null==n||null===(i=n[e])||void 0===i||null===(i=i.Renewal)||void 0===i?void 0:i.ProductId)>0}},{key:"yearsForGame",value:function(e){var t,i;return"ArkSA"===e?this.arkSAYears:Math.min(this.getQuantity(null==n||null===(t=n[e])||void 0===t||null===(t=t.Base)||void 0===t?void 0:t.ProductId)+this.getQuantity(null==n||null===(i=n[e])||void 0===i||null===(i=i.Renewal)||void 0===i?void 0:i.ProductId),5)}},{key:"yearsForOtherGames",value:function(){var e,t={},n=A(l);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.yearsForGame(i.gameId)>0&&(t[i.gameId]=this.yearsForGame(i.gameId))}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"build",value:function(e,t,i,a,r){if(this.reset(),this.isGift=t,i&&(t||null===e.arkLicense)&&this.setQuantity(n.Ark.Base.ProductId,1),a>0&&(a=Math.min(a,5),t?(i?this.setQuantity(n.ArkSA.Upgrade.ProductId,1):this.setQuantity(n.ArkSA.Base.ProductId,1),a>1&&this.setQuantity(n.ArkSA.Renewal.ProductId,a-1)):null!==e.arkSALicense?this.setQuantity(n.ArkSA.Renewal.ProductId,a):(i||null!==e.arkLicense?this.setQuantity(n.ArkSA.Upgrade.ProductId,1):this.setQuantity(n.ArkSA.Base.ProductId,1),a>1&&this.setQuantity(n.ArkSA.Renewal.ProductId,a-1))),r){var o,c=A(l);try{for(c.s();!(o=c.n()).done;){var s,u=o.value,d=Math.min(null!==(s=r[u.gameId])&&void 0!==s?s:0,5);0!==d&&(!1===t&&null!==e.findLicense(n[u.gameId].Base.ProductId)?this.setQuantity(n[u.gameId].Renewal.ProductId,d):(this.setQuantity(n[u.gameId].Base.ProductId,1),d>1&&this.setQuantity(n[u.gameId].Renewal.ProductId,d-1)))}}catch(e){c.e(e)}finally{c.f()}}}},{key:"rebuild",value:function(e){var t=this.fingerprint;return this.build(e,this.isGift,this.hasArk,this.arkSAYears,this.yearsForOtherGames()),this.fingerprint!==t}},{key:"consume",value:function(e,t){if(t){if(this.isGift!==t.isGift)throw new Error("Cannot merge a gift item with a non-gift item.");for(var n=this.hasArk||t.hasArk,i=this.arkSAYears+t.arkSAYears,a=this.yearsForOtherGames(),r=t.yearsForOtherGames(),o=0,c=Object.entries(r);o<c.length;o++){var l,s=(h=c[o],f=2,function(e){if(Array.isArray(e))return e}(h)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,r,o,c=[],l=!0,s=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(c.push(i.value),c.length!==t);l=!0);}catch(e){s=!0,a=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(s)throw a}}return c}}(h,f)||S(h,f)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=s[0],d=s[1];a[u]=(null!==(l=a[u])&&void 0!==l?l:0)+d}this.build(e,this.isGift,n,i,a)}var h,f}},{key:"total",get:function(){var e,t=0,n=A(this.productIds);try{for(n.s();!(e=n.n()).done;){var a=e.value;t+=i[a].Price*this.getQuantity(a)}}catch(e){n.e(e)}finally{n.f()}return t}}]),e}(),y=new WeakMap,g=new WeakMap,w=new WeakMap,C=new WeakMap,P=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(I(this,e),L(this,y,{writable:!0,value:[]}),L(this,g,{writable:!0,value:null}),L(this,w,{writable:!0,value:!1}),L(this,C,{writable:!0,value:[]}),t)try{var n=JSON.parse(t);x(this,g,n.email),x(this,y,n.items.reduce((function(e,t){var n=new f(t);return n.count>0&&e.push(n),e}),[])),x(this,C,n.licenses)}catch(e){console.log("Failed to load saved cart")}}return B(e,[{key:"reset",value:function(){x(this,y,[]),x(this,g,null),x(this,w,!1),x(this,C,[]),this.save()}},{key:"toJSON",value:function(){return{email:T(this,g),items:T(this,y).reduce((function(e,t){return t.count>0&&e.push(t),e}),[]),licenses:T(this,C)}}},{key:"save",value:function(){localStorage.setItem("beaconCart",JSON.stringify(this))}},{key:"add",value:function(e){T(this,y).push(e),this.save()}},{key:"remove",value:function(e){x(this,y,T(this,y).filter((function(t){return t.id!==e.id}))),this.save()}},{key:"hasProduct",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=A(T(this,y));try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.getQuantity(e)>0&&a.isGift===n)return!0}}catch(e){i.e(e)}finally{i.f()}return!1}},{key:"email",get:function(){return T(this,g)}},{key:"setEmail",value:function(e){var t=this;return new Promise((function(i,a){var r=function(){var e,i=t.personalCartItem;return!!i&&(i.hasArk&&t.arkLicense?(i.setQuantity(null===(e=n.Ark)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId,0),0===i.count&&t.remove(i),!0):i.rebuild(t))};if(null===e){x(t,g,null),x(t,w,!1),x(t,C,[]);var o=r();return t.save(),void i({newEmail:null,cartChanged:o})}if(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).trim().toLowerCase())){var l=new URLSearchParams;l.append("email",e),c.get("/omni/lookup?".concat(l.toString())).then((function(n){var a=JSON.parse(n.body);x(t,g,a.email),x(t,w,a.verified),x(t,C,a.purchases);var o=r();t.save(),i({newEmail:e,cartChanged:o})})).catch((function(e){x(t,g,null),x(t,w,!1),x(t,C,[]),r(),t.save(),a(e.statusText)}))}else a("Address is not valid")}))}},{key:"emailVerified",get:function(){return T(this,w)}},{key:"checkingEmail",get:function(){return!1}},{key:"items",get:function(){return function(e){if(Array.isArray(e))return E(e)}(e=T(this,y))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||S(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();var e}},{key:"count",get:function(){return T(this,y).reduce((function(e,t){return t.count>0&&e++,e}),0)}},{key:"findLicense",value:function(e){var t,n=A(T(this,C));try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.productId===e)return i}}catch(e){n.e(e)}finally{n.f()}return null}},{key:"arkLicense",get:function(){var e;return this.findLicense(null==n||null===(e=n.Ark)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)}},{key:"arkSALicense",get:function(){var e;return this.findLicense(null==n||null===(e=n.ArkSA)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)}},{key:"ark2License",get:function(){return null}},{key:"personalCartItem",get:function(){var e,t=A(T(this,y));try{for(t.s();!(e=t.n()).done;){var n=e.value;if(!1===n.isGift)return n}}catch(e){t.e(e)}finally{t.f()}return null}},{key:"total",get:function(){var e,t=0,n=A(T(this,y));try{for(n.s();!(e=n.n()).done;)t+=e.value.total}catch(e){n.e(e)}finally{n.f()}return t}}],[{key:"load",value:function(){return new this(localStorage.getItem("beaconCart"))}}]),e}(),O=P.load(),G=new WeakMap,N=new WeakMap,R=function(){function e(t){I(this,e),L(this,G,{writable:!0,value:[]}),L(this,N,{writable:!0,value:null}),T(this,G).push(t)}return B(e,[{key:"currentView",get:function(){return T(this,G).slice(-1)}},{key:"back",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return!(T(this,G).length<=1||(this.switchView(T(this,G)[T(this,G).length-2],e),x(this,G,T(this,G).slice(0,T(this,G).length-2)),0))}},{key:"clearHistory",value:function(){T(this,G).length<=1||x(this,G,T(this,G).slice(-1))}},{key:"switchView",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.currentView!==e){T(this,N)&&(clearTimeout(T(this,N)),x(this,N,null));var i=document.getElementById(this.currentView),a=document.getElementById(e);T(this,G).push(e),n?(i.classList.add("invisible"),x(this,N,setTimeout((function(){i.classList.add("hidden"),a.classList.remove("hidden"),x(t,N,setTimeout((function(){a.classList.remove("invisible"),x(t,N,null)}),150))}),150))):(i.classList.add("hidden"),i.classList.add("invisible"),a.classList.remove("invisible"),a.classList.remove("hidden"))}}}]),e}();new R("checkout-wizard-start");var Q=new R("page-landing"),z=document.getElementById("buy-button"),U=document.getElementById("cart-back-button"),H=function(){document.title="Buy Beacon Omni",history.pushState({},"","/omni#checkout"),dispatchEvent(new PopStateEvent("popstate",{}))},V={cancelButton:document.getElementById("checkout-email-cancel"),actionButton:document.getElementById("checkout-email-action"),emailField:document.getElementById("checkout-email-field"),errorField:document.getElementById("checkout-email-error"),allowsSkipping:!1,successFunction:function(e){},init:function(){var e=this,t=function(t){e.actionButton.disabled=!0,e.cancelButton.disabled=!0,e.errorField.classList.add("hidden"),O.setEmail(t).then((function(t){t.newEmail;var n=t.cartChanged;a.hideModal(),setTimeout((function(){e.successFunction(n)}),310)})).catch((function(t){e.errorField.innerText=t,e.errorField.classList.remove("hidden")})).finally((function(){e.actionButton.disabled=!1,e.cancelButton.disabled=!1}))};this.actionButton.addEventListener("click",(function(n){n.preventDefault(),t(e.emailField.value)})),this.cancelButton.addEventListener("click",(function(n){n.preventDefault(),e.allowsSkipping?t(null):a.hideModal()}))},present:function(e,n){t.forceEmail?O.setEmail(t.forceEmail).then((function(e){e.newEmail;var t=e.cartChanged;n(t)})):(this.allowsSkipping=e,this.successFunction=n,O.email?this.emailField.value=O.email:this.emailField.value=sessionStorage.getItem("email")||localStorage.getItem("email")||"",this.cancelButton.innerText=e?"Skip For Now":"Cancel",a.showModal("checkout-email"))}};V.init();var W={cartView:null,editCartItem:null,actionButton:document.getElementById("checkout-wizard-action"),arkCheck:document.getElementById("checkout-wizard-ark-check"),arkOnlyCheck:document.getElementById("storefront-ark-check"),arkOnlyGiftDownButton:document.getElementById("storefront-ark-gift-decrease"),arkOnlyGiftField:document.getElementById("storefront-ark-gift-field"),arkOnlyGiftQuantityGroup:document.getElementById("storefront-ark-gift-group"),arkOnlyGiftUpButton:document.getElementById("storefront-ark-gift-increase"),arkOnlyOwnedField:document.getElementById("storefront-ark-owned"),arkPriceField:document.getElementById("checkout-wizard-ark-price"),arkSACheck:document.getElementById("checkout-wizard-arksa-check"),arkSADurationDownButton:document.getElementById("checkout-wizard-arksa-yeardown-button"),arkSADurationField:document.getElementById("checkout-wizard-arksa-duration-field"),arkSADurationGroup:document.getElementById("checkout-wizard-arksa-duration-group"),arkSADurationUpButton:document.getElementById("checkout-wizard-arksa-yearup-button"),arkSAPriceField:document.getElementById("checkout-wizard-arksa-full-price"),arkSAPromoField:document.getElementById("checkout-wizard-promo-arksa"),arkSAStatusField:document.getElementById("checkout-wizard-status-arksa"),arkSAUpgradePriceField:document.getElementById("checkout-wizard-arksa-discount-price"),arkStatusField:document.getElementById("checkout-wizard-status-ark"),giftCheck:document.getElementById("checkout-wizard-gift-check"),cancelButton:document.getElementById("checkout-wizard-cancel"),init:function(e){var t=this;this.cartView=e;var n,i=A(l);try{for(i.s();!(n=i.n()).done;){var r=n.value.gameId.toLowerCase();this["".concat(r,"Check")]=document.getElementById("checkout-wizard-".concat(r,"-check")),this["".concat(r,"DurationDownButton")]=document.getElementById("checkout-wizard-".concat(r,"-yeardown-button")),this["".concat(r,"DurationField")]=document.getElementById("checkout-wizard-".concat(r,"-duration-field")),this["".concat(r,"DurationGroup")]=document.getElementById("checkout-wizard-".concat(r,"-duration-group")),this["".concat(r,"DurationUpButton")]=document.getElementById("checkout-wizard-".concat(r,"-yearup-button")),this["".concat(r,"PriceField")]=document.getElementById("checkout-wizard-".concat(r,"-price")),this["".concat(r,"StatusField")]=document.getElementById("checkout-wizard-status-".concat(r))}}catch(e){i.e(e)}finally{i.f()}if(this.cancelButton&&this.cancelButton.addEventListener("click",(function(e){e.preventDefault(),a.hideModal()})),this.actionButton&&this.actionButton.addEventListener("click",(function(e){e.preventDefault();var n,i=t.giftCheck.checked,r=t.arkCheck&&!1===t.arkCheck.disabled&&t.arkCheck.checked,o=t.arkSACheck&&!1===t.arkSACheck.disabled&&t.arkSACheck.checked,c=!1,s={},u=A(l);try{for(u.s();!(n=u.n()).done;){var d=n.value.gameId,h=d.toLowerCase();t["".concat(h,"Check")]&&!1===t["".concat(h,"Check")].disabled&&t["".concat(h,"Check")].checked&&(c=!0,s[d]=parseInt(t["".concat(h,"DurationField")].value)||1)}}catch(e){u.e(e)}finally{u.f()}if(!1!==(r||o||c)){var v,m=o?parseInt(t.arkSADurationField.value)||1:0;if(t.editCartItem?v=t.editCartItem:(v=new f).isGift=i,v.build(O,i,r,m,s),!1===Boolean(t.editCartItem)){var k=O.personalCartItem;!1===i&&!0===Boolean(k)?k.consume(O,v):O.add(v)}O.save(),t.cartView.update(),H(),a.hideModal()}})),this.giftCheck&&this.giftCheck.addEventListener("change",(function(){t.update()})),this.arkCheck&&this.arkCheck.addEventListener("change",(function(){t.update()})),this.arkSACheck&&this.arkSADurationField&&this.arkSADurationUpButton&&this.arkSADurationDownButton&&this.arkSADurationGroup){this.arkSACheck.addEventListener("change",(function(){t.update()})),this.arkSADurationField.addEventListener("input",(function(){t.update()}));var o=function(e){var n=parseInt(t.arkSADurationField.value),i=n+e;(i>5||i<1)&&(t.arkSADurationGroup.classList.add("shake"),setTimeout((function(){t.arkSADurationGroup.classList.remove("shake")}),400),i=Math.max(Math.min(i,5),1)),n!==i&&(t.arkSADurationField.value=i,t.arkSACheck.checked=!0,t.update())};this.arkSADurationUpButton.addEventListener("click",(function(e){e.preventDefault(),o(1)})),this.arkSADurationDownButton.addEventListener("click",(function(e){e.preventDefault(),o(-1)}))}var c,s=A(l);try{var u=function(){var e=c.value.gameId.toLowerCase(),n=t["".concat(e,"Check")],i=t["".concat(e,"DurationField")],a=t["".concat(e,"DurationUpButton")],r=t["".concat(e,"DurationDownButton")],o=t["".concat(e,"DurationGroup")];if(n&&i&&a&&r&&o){n.addEventListener("change",(function(){t.update()})),i.addEventListener("input",(function(){t.update()}));var l=function(e){var a=parseInt(i.value),r=a+e;(r>5||r<1)&&(o.classList.add("shake"),setTimeout((function(){o.classList.remove("shake")}),400),r=Math.max(Math.min(r,5),1)),a!==r&&(i.value=r,n.checked=!0,t.update())};a.addEventListener("click",(function(e){e.preventDefault(),l(1)})),r.addEventListener("click",(function(e){e.preventDefault(),l(-1)}))}};for(s.s();!(c=s.n()).done;)u()}catch(e){s.e(e)}finally{s.f()}if(this.arkOnlyCheck&&this.arkOnlyCheck.addEventListener("change",(function(e){if(e.preventDefault(),e.currentTarget.checked){var n=O.personalCartItem;n||(n=new f,O.add(n)),n.build(O,!1,!0,0),O.save()}else{var i=O.personalCartItem;i&&O.remove(i)}t.cartView.update()})),this.arkOnlyGiftField){var d=function(e){var n=O.items.filter((function(e){return!0===e.isGift&&e.hasArk}));if(n.length!==e){if(n.length>e)for(var i=e;i<=n.length-1;i++)O.remove(n[i]);else if(n.length<e)for(var a=n.length;a<e;a++){var r=new f;r.build(O,!0,!0,0),O.add(r)}t.cartView.update()}};this.arkOnlyGiftField.addEventListener("input",(function(e){var t=Math.min(Math.max(parseInt(e.currentTarget.value),0),5);d(t)})),this.arkOnlyGiftField.addEventListener("blur",(function(){t.cartView.update()}));var h=function(e){var n=parseInt(t.arkOnlyGiftField.value),i=n+e;(i>5||i<0)&&(t.arkOnlyGiftQuantityGroup.classList.add("shake"),setTimeout((function(){t.arkOnlyGiftQuantityGroup.classList.remove("shake")}),400),i=Math.max(Math.min(i,5),0)),n!==i&&(t.arkOnlyGiftField.value=i,d(i))};this.arkOnlyGiftUpButton.addEventListener("click",(function(e){e.preventDefault(),h(1)})),this.arkOnlyGiftDownButton.addEventListener("click",(function(e){e.preventDefault(),h(-1)}))}},filter:function(e){var t,n=!0,i=A(document.querySelectorAll(".checkout-wizard-list-game"));try{for(i.s();!(t=i.n()).done;){var a=t.value,r=a.getAttribute("beacon-game-id");0===e.length||e.includes(r)||("Ark"===r||"ArkSA"===r)&&(e.includes("Ark")||e.includes("ArkSA"))?(a.classList.remove("hidden"),n?(n=!1,a.classList.remove("separated")):a.classList.add("separated")):a.classList.add("hidden")}}catch(e){i.e(e)}finally{i.f()}},present:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.filter(t),t.length>0&&!1===t.includes(n)&&(n=null),this.editCartItem=e,this.arkCheck.disabled=!1,this.arkSACheck&&(this.arkSACheck.disabled=!1);var i,r=A(l);try{for(r.s();!(i=r.n()).done;){var o=i.value.gameId.toLowerCase();this["".concat(o,"Check")]&&(this["".concat(o,"Check")].disabled=!1)}}catch(e){r.e(e)}finally{r.f()}if(e){this.giftCheck.checked=e.isGift,this.giftCheck.disabled=!0,this.arkCheck.checked=e.hasArk,this.arkSACheck&&(this.arkSACheck.checked=e.hasArkSA);var c,s=A(l);try{for(s.s();!(c=s.n()).done;){var u=c.value.gameId,d=u.toLowerCase();this["".concat(d,"Check")]&&(this["".concat(d,"Check")].checked=e.hasGame(u))}}catch(e){s.e(e)}finally{s.f()}}else{this.giftCheck.checked=!1,this.giftCheck.disabled=!1,this.arkCheck.checked="Ark"===n,this.arkSACheck&&(this.arkSACheck.checked="ArkSA"===n);var h,f=A(l);try{for(f.s();!(h=f.n()).done;){var v=h.value.gameId,m=v.toLowerCase();this["".concat(m,"Check")]&&(this["".concat(m,"Check")].checked=n===v)}}catch(e){f.e(e)}finally{f.f()}}this.arkSADurationField&&(this.arkSADurationField.value=e?e.arkSAYears:"1");var k,p=A(l);try{for(p.s();!(k=p.n()).done;){var y=k.value.gameId,g=y.toLowerCase();this["".concat(g,"DurationField")].value=e?e.yearsForGame(y):"1"}}catch(e){p.e(e)}finally{p.f()}this.cancelButton.innerText="Cancel",this.update(),a.showModal("checkout-wizard")},getGameStatus:function(){var e,t={Ark:j,ArkSA:j},i=A(l);try{for(i.s();!(e=i.n()).done;)t[e.value.gameId]=j}catch(e){i.e(e)}finally{i.f()}var a=O.personalCartItem,r=Boolean(this.editCartItem);if(this.giftCheck&&this.giftCheck.checked){t.Ark=this.arkCheck&&!1===this.arkCheck.disabled&&this.arkCheck.checked?M:j,t.ArkSA=this.arkSACheck&&!1===this.arkSACheck.disabled&&this.arkSACheck.checked?M:j;var o,c=A(l);try{for(c.s();!(o=c.n()).done;){var s=o.value,u=s.gameId.toLowerCase();t[s.gameId]=this["".concat(u,"Check")]&&!1===this["".concat(u,"Check")].disabled&&this["".concat(u,"Check")].checked?M:j}}catch(e){c.e(e)}finally{c.f()}}else{O.arkLicense?t.Ark=F:a&&(!1===r||a.id!==this.editCartItem.id)&&a.hasArk?t.Ark=D:this.arkCheck&&!1===this.arkCheck.disabled&&this.arkCheck.checked?t.Ark=M:t.Ark=j,O.arkSALicense?t.ArkSA=F:a&&(!1===r||a.id!==this.editCartItem.id)&&a.hasArkSA?t.ArkSA=D:this.arkSACheck&&this.arkSACheck&&!1===this.arkSACheck.disabled&&this.arkSACheck.checked?t.ArkSA=M:t.ArkSA=j;var d,h=A(l);try{for(h.s();!(d=h.n()).done;){var f,v=d.value.gameId,m=v.toLowerCase();O.findLicense(null===(f=n[v])||void 0===f||null===(f=f.Base)||void 0===f?void 0:f.ProductId)?t[v]=F:a&&(!1===r||a.id!==this.editCartItem.id)&&a.hasGame(v)?t[v]=D:this["".concat(m,"Check")]&&!1===this["".concat(m,"Check")].disabled&&this["".concat(m,"Check")].checked?t[v]=M:t[v]=j}}catch(e){h.e(e)}finally{h.f()}}return t},update:function(){var e=this.getGameStatus(),t=0;if(this.arkCheck&&!1===this.arkCheck.disabled&&!0===this.arkCheck.checked&&(t+=n.Ark.Base.Price),this.arkSACheck){var i=n.ArkSA.Base.Price,a=n.ArkSA.Base.Price,o=Math.min(Math.max(parseInt(this.arkSADurationField.value)||1,1),5);parseInt(this.arkSADurationField.value)!==o&&document.activeElement!==this.arkSADurationField&&(this.arkSADurationField.value=o);var c=Math.max(o-1,0),s=Math.round((n.ArkSA.Base.Price-n.ArkSA.Upgrade.Price)/n.ArkSA.Base.Price*100);if(this.arkSAPromoField.innerText="".concat(s,"% off first year when bundled with ").concat(n.Ark.Base.Name),e.ArkSA===F){var u,d=O.arkSALicense,h=Math.floor(Date.now()/1e3),f=d.expiresEpoch,v=p(k(f),!1),m=(h>f?86400*Math.floor(h/86400)+86400:f)+n.ArkSA.Renewal.PlanLengthSeconds*o,y=p(k(m),!1);u=h>f?'Renew your update plan<br>Expired on <span class="text-red">'.concat(v,'</span><br>New expiration: <span class="text-green">').concat(y,"</span>"):'Extend your update plan<br>Expires on <span class="text-green">'.concat(v,'</span><br>New expiration: <span class="text-green">').concat(y,"</span>"),this.arkSAStatusField.innerHTML=u,a=i=n.ArkSA.Renewal.Price*o,this.arkSAPromoField.innerText="",this.arkSAPromoField.classList.add("hidden")}else if(e.ArkSA===D)a=i=n.ArkSA.Renewal.Price*o,this.arkSAStatusField.innerText="Additional renewal years for ".concat(n.ArkSA.Base.Name," in your cart."),this.arkSAPromoField.innerText="",this.arkSAPromoField.classList.add("hidden");else if(e.Ark!==j){i=n.ArkSA.Base.Price+n.ArkSA.Renewal.Price*c,a=n.ArkSA.Upgrade.Price+n.ArkSA.Renewal.Price*c;var g=e.Ark===F?"because you own":"when bundled with";this.arkSAStatusField.innerText="Includes 1 year of app updates. Additional years cost ".concat(r(n.ArkSA.Renewal.Price)," each."),this.arkSAPromoField.innerText="".concat(s,"% off first year ").concat(g," ").concat(n.Ark.Base.Name),this.arkSAPromoField.classList.remove("hidden")}else this.arkSAStatusField.innerText="Includes 1 year of app updates. Additional years cost ".concat(r(n.ArkSA.Renewal.Price)," each."),this.arkSAPromoField.innerText="".concat(s,"% off first year when bundled with ").concat(n.Ark.Base.Name),this.arkSAPromoField.classList.remove("hidden"),a=i=n.ArkSA.Base.Price+n.ArkSA.Renewal.Price*c;this.arkSAPriceField.classList.toggle("checkout-wizard-discounted",i!==a),this.arkSAPriceField.innerText=r(i),this.arkSAUpgradePriceField.classList.toggle("hidden",i===a),this.arkSAUpgradePriceField.innerText=r(a),!1===this.arkSACheck.disabled&&!0===this.arkSACheck.checked&&(t+=a)}e.Ark===F?(this.arkStatusField.innerText="You already own ".concat(n.Ark.Base.Name,"."),this.arkCheck.disabled=!0,this.arkCheck.checked=!1):e.Ark===D?(this.arkStatusField.innerText="".concat(n.Ark.Base.Name," is already in your cart."),this.arkCheck.disabled=!0,this.arkCheck.checked=!1):(this.arkStatusField.innerText="Includes lifetime app updates.",this.arkCheck.disabled=!1);var b,w=A(l);try{for(w.s();!(b=w.n()).done;){var S,E,I=b.value.gameId,C=I.toLowerCase(),B=this["".concat(C,"Check")],P=this["".concat(C,"DurationField")],L=this["".concat(C,"StatusField")],T=this["".concat(C,"PriceField")];if(B){var x=null===(S=n[I])||void 0===S||null===(S=S.Base)||void 0===S?void 0:S.Price,M=null===(null===(E=n[I])||void 0===E||null===(E=E.Base)||void 0===E?void 0:E.PlanLengthSeconds),G=Math.min(Math.max(parseInt(P.value)||1,1),5);parseInt(P.value)!==G&&document.activeElement!==P&&(P.value=G);var N,R=Math.max(G-1,0);if(M)if(e[I]===F)L.innerHTML="You already own ".concat(null===(N=n[I])||void 0===N||null===(N=N.Base)||void 0===N?void 0:N.Name,"."),B.disabled=!0,B.checked=!1;else if(e[I]===D){var Q;L.innerText="".concat(null===(Q=n[I])||void 0===Q||null===(Q=Q.Base)||void 0===Q?void 0:Q.Name," is already in your cart."),B.disabled=!0,B.checked=!1}else L.innerText="Includes lifetime app updates.",B.disabled=!1;else if(e[I]===F){var z,U,H,V=O.findLicense(null===(z=n[I])||void 0===z||null===(z=z.Base)||void 0===z?void 0:z.ProductId),W=Math.floor(Date.now()/1e3),Y=V.expiresEpoch,J=p(k(Y),!1),q=(W>Y?86400*Math.floor(W/86400)+86400:Y)+(null===(U=n[I])||void 0===U||null===(U=U.Renewal)||void 0===U?void 0:U.PlanLengthSeconds)*G,_=p(k(q),!1);H=W>Y?'Renew your update plan<br>Expired on <span class="text-red">'.concat(J,'</span><br>New expiration: <span class="text-green">').concat(_,"</span>"):'Extend your update plan<br>Expires on <span class="text-green">'.concat(J,'</span><br>New expiration: <span class="text-green">').concat(_,"</span>"),L.innerHTML=H}else if(e[I]===D){var Z,$;x=(null===(Z=n[I])||void 0===Z||null===(Z=Z.Renewal)||void 0===Z?void 0:Z.Price)*G,L.innerText="Additional renewal years for ".concat(null===($=n[I])||void 0===$||null===($=$.Base)||void 0===$?void 0:$.Name," in your cart.")}else{var X,K,ee,te;L.innerText="Includes ".concat(null===(X=n[I])||void 0===X||null===(X=X.Renewal)||void 0===X?void 0:X.PlanLength," of app updates. Additional years cost ").concat(r(null===(K=n[I])||void 0===K||null===(K=K.Renewal)||void 0===K?void 0:K.Price)," each."),x=(null===(ee=n[I])||void 0===ee||null===(ee=ee.Base)||void 0===ee?void 0:ee.Price)+(null===(te=n[I])||void 0===te||null===(te=te.Renewal)||void 0===te?void 0:te.Price)*R}T.innerText=r(x),!1===B.disabled&&!0===B.checked&&(t+=x)}}}catch(e){w.e(e)}finally{w.f()}var ne=this.editCartItem?"Edit":"Add to Cart";t>0?(this.actionButton.disabled=!1,this.actionButton.innerText="".concat(ne,": ").concat(r(t))):(this.actionButton.disabled=!0,this.actionButton.innerText=ne)}},Y={wizard:null,emailField:document.getElementById("storefront-cart-header-email-field"),changeEmailButton:document.getElementById("storefront-cart-header-email-button"),currencyMenu:document.getElementById("storefront-cart-currency-menu"),addMoreButton:document.getElementById("storefront-cart-more-button"),checkoutButton:document.getElementById("storefront-cart-checkout-button"),refundCheckbox:document.getElementById("storefront-refund-checkbox"),footer:document.getElementById("storefront-cart-footer"),body:document.getElementById("storefront-cart"),totalField:document.getElementById("storefront-cart-total"),init:function(e){var t=this;this.wizard=e,this.currencyMenu.addEventListener("change",(function(e){e.preventDefault(),c.get("/omni/currency?currency=".concat(e.target.value)).then((function(){window.location.reload()})).catch((function(e){console.log(JSON.stringify(e)),a.show("Currency was not changed",e.statusText)}))})),this.addMoreButton.addEventListener("click",(function(e){e.preventDefault(),t.wizard.present()})),this.checkoutButton.addEventListener("click",(function(e){e.preventDefault();var n=t.refundCheckbox.checked,i=function(e){t.update(),e?O.count>0?a.show("Your cart contents have changed.","The items in your cart have changed based on your e-mail address. Please review before continuing checkout."):a.show("Your cart is now empty.","You already own everything in your cart. There is no need to purchase again."):(t.checkoutButton.disabled=!0,c.post("/omni/begin",b(b({},O.toJSON()),{},{refundPolicyAgreed:n})).then((function(e){try{var t=JSON.parse(e.body),n=t.url;sessionStorage.setItem("clientReferenceId",t.client_reference_id),window.location=n}catch(t){console.log(e.body),a.show("Unknown Error","There was an unknown error while starting the checkout process.")}})).catch((function(e){try{var t=JSON.parse(e.body).message;a.show("Checkout Error",t)}catch(t){console.log(e.body),a.show("Unknown Error","There was an unknown error while starting the checkout process.")}})).finally((function(){t.checkoutButton.disabled=!1})))};O.email?n?i(!1):a.show("Hang on","Please agree to the refund policy."):V.present(!1,i)})),this.changeEmailButton.addEventListener("click",(function(e){e.preventDefault(),V.present(!1,(function(){t.update()}))})),this.update()},update:function(){var e,n=this;if(O.count>0)this.emailField.innerText=O.email,this.changeEmailButton.disabled=Boolean(t.forceEmail),this.changeEmailButton.innerText=O.email?"Change Email":"Set Email",this.changeEmailButton.classList.remove("hidden"),this.body.innerText="",this.body.classList.remove("empty"),this.footer.classList.remove("hidden"),O.items.forEach((function(e){var t=n.createCartItemRow(e);t&&n.body.appendChild(t)})),z.innerText="Go to Cart";else{this.emailField.innerText="",this.changeEmailButton.classList.add("hidden"),this.body.innerText="",this.body.classList.add("empty"),this.footer.classList.add("hidden"),this.body.appendChild(document.createElement("div"));var i=document.createElement("div"),a=document.createElement("p");a.appendChild(document.createTextNode("Your cart is empty.")),i.appendChild(a),this.buyMoreButton=document.createElement("button"),this.buyMoreButton.addEventListener("click",(function(){V.present(!0,(function(){n.wizard.present()}))})),this.buyMoreButton.classList.add("default"),this.buyMoreButton.appendChild(document.createTextNode("Buy Omni"));var r=document.createElement("p");r.appendChild(this.buyMoreButton),i.appendChild(r),this.body.appendChild(i),this.body.appendChild(document.createElement("div")),z.innerText="Buy Omni"}this.totalField.setAttribute("beacon-price",O.total),e=t.currencyCode,document.querySelectorAll(".formatted-price").forEach((function(t){var n,i=parseFloat(null!==(n=t.getAttribute("beacon-price"))&&void 0!==n?n:t.innerText),a=t.getAttribute("beacon-currency"),r=m(null!=a?a:e);r&&(t.innerText=r(i))})),this.checkoutButton.disabled=0===O.total},createProductRow:function(e,t){var n=e.getQuantity(t);if(n<=0)return null;var a=i[t].Name,r=i[t].Price,o=document.createElement("div");o.appendChild(document.createTextNode(n));var c=document.createElement("div");c.appendChild(document.createTextNode(a));var l=document.createElement("div");l.classList.add("formatted-price"),l.appendChild(document.createTextNode(r*n));var s=document.createElement("div");return s.classList.add("bundle-product"),s.appendChild(o),s.appendChild(c),s.appendChild(l),s},createCartItemRow:function(e){var t=this,n=e.productIds;if(n.length<=0)return null;var i=document.createElement("div");i.classList.add("bundle"),n.forEach((function(n){var a=t.createProductRow(e,n);a&&i.appendChild(a)}));var a=document.createElement("div");e.isGift&&(i.classList.add("gift"),a.classList.add("gift"),n.length>1?a.appendChild(document.createTextNode("These products are a gift. You will receive a gift code for them.")):a.appendChild(document.createTextNode("This product is a gift. You will receive a gift code for it.")));var r=document.createElement("button");r.appendChild(document.createTextNode("Edit")),r.classList.add("small"),r.addEventListener("click",(function(n){n.preventDefault(),t.wizard.present(e)}));var o=document.createElement("button");o.appendChild(document.createTextNode("Remove")),o.classList.add("red"),o.classList.add("small"),o.addEventListener("click",(function(n){n.preventDefault(),O.remove(e),t.update()}));var c=document.createElement("div");c.classList.add("button-group"),c.appendChild(r),c.appendChild(o);var l=document.createElement("div");l.appendChild(c);var s=document.createElement("div");return s.classList.add("actions"),s.classList.add("double-group"),s.appendChild(a),s.appendChild(l),i.appendChild(s),i}};W.init(Y),Y.init(W);var J=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=window.location.hash.substring(1);if(s&&s.hasPage(t))return Q.switchView("page-landing",e),void s.switchPage(t);window.scrollTo(window.scrollX,0),"checkout"===t?Q.switchView("page-cart",e):Q.back(e)};z.addEventListener("click",(function(e){e.preventDefault(),O.count>0?H():V.present(!0,(function(){W.present()}))}));var q,_=A(o);try{var Z=function(){var e=q.value.gameId,t=document.getElementById("checkout-buy-".concat(e.toLowerCase(),"-button"));if(!t)return"continue";t.addEventListener("click",(function(t){t.preventDefault();var n=function(){W.present(null,[e],e)};O.count>0?n():V.present(!0,n)}))};for(_.s();!(q=_.n()).done;)Z()}catch(e){_.e(e)}finally{_.f()}U.addEventListener("click",(function(){s?(s.currentPageTitle?document.title="Beacon Omni for ".concat(s.currentPageTitle):document.title="Beacon Omni",history.pushState({},"","/omni#".concat(s.currentPageName))):(document.title="Beacon Omni",history.pushState({},"","/omni")),dispatchEvent(new PopStateEvent("popstate",{}))})),window.addEventListener("popstate",(function(){J(!0)})),J(!1),t.forceEmail&&(O.email!==t.forceEmail&&O.reset(),0===O.count?V.present(!0,(function(){W.present()})):H())}))})();